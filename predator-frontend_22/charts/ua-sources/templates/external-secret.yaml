{{- if .Values.vault.enabled -}}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "ua-sources.fullname" . }}-secrets
  labels:
    {{- include "ua-sources.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ .Values.vault.secretStore }}
    kind: ClusterSecretStore
  target:
    name: {{ include "ua-sources.fullname" . }}-secrets
    creationPolicy: Owner
  data:
    # --- FINANCE ---
    - secretKey: ALPHA_VANTAGE_API_KEY
      remoteRef:
        key: external/alpha_vantage
        property: api_key
    - secretKey: FINNHUB_API_KEY
      remoteRef:
        key: external/finnhub
        property: api_key
    - secretKey: FIXER_API_KEY
      remoteRef:
        key: external/fixer
        property: api_key
    - secretKey: MARKETSTACK_API_KEY
      remoteRef:
        key: external/marketstack
        property: api_key
    - secretKey: FMP_API_KEY
      remoteRef:
        key: external/fmp
        property: api_key
        
    # --- CYBERSEC ---
    - secretKey: ABUSEIPDB_API_KEY
      remoteRef:
        key: external/abuseipdb
        property: api_key
    - secretKey: VIRUSTOTAL_API_KEY
      remoteRef:
        key: external/virustotal
        property: api_key
    - secretKey: HIBP_API_KEY
      remoteRef:
        key: external/hibp
        property: api_key
    - secretKey: PULSEDIVE_API_KEY
      remoteRef:
        key: external/pulsedive
        property: api_key
    - secretKey: GSB_API_KEY
      remoteRef:
        key: external/google_safe_browsing
        property: api_key
        
    # --- NEWS / WEATHER / GEO ---
    - secretKey: NEWSAPI_API_KEY
      remoteRef:
        key: external/newsapi
        property: api_key
    - secretKey: OPENWEATHER_API_KEY
      remoteRef:
        key: external/openweather
        property: api_key
    - secretKey: IPSTACK_API_KEY
      remoteRef:
        key: external/ipstack
        property: api_key
        
    # --- UKRAINE GOV / REGISTRIES ---
    - secretKey: OPENDATABOT_API_KEY
      remoteRef:
        key: external/opendatabot
        property: api_key
    - secretKey: UA_TAX_CABINET_KEY
      remoteRef:
        key: external/ua_tax/cabinet
        property: api_key
    - secretKey: UA_PROZORRO_API_KEY
      remoteRef:
        key: external/ua_prozorro
        property: api_key
    - secretKey: UA_CUSTOMS_EDS_KEY
      remoteRef:
        key: external/ua_customs/eds
        property: key_data
{{- end }}
