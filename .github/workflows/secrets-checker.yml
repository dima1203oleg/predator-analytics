name: Secrets Checker

on:
  workflow_dispatch:

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Check required secrets and variables
        run: |
          set -e
          missing=()
          # List of required secrets
          for s in GITHUB_TOKEN GEMINI_API_KEY AI_STUDIO_UPLOAD_ENDPOINT AI_STUDIO_TOKEN GHCR_PAT; do
            if ! gh secret list | grep -q "^$s"; then
              missing+=("secret:$s")
            fi
          done
          # List of required variables
          for v in GEMINI_CLI_VERSION GCP_WIF_PROVIDER GOOGLE_CLOUD_PROJECT GOOGLE_CLOUD_LOCATION SERVICE_ACCOUNT_EMAIL AI_ISSUE_ASSIGNEES AI_BLOCK_THRESHOLD; do
            if ! gh variable list | grep -q "^$v"; then
              missing+=("var:$v")
            fi
          done
          if [ ${#missing[@]} -eq 0 ]; then
            echo "All required secrets and variables are present."
          else
            echo "Missing: ${missing[*]}" && exit 1
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}