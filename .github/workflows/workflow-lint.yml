name: Workflow Lint

on:
  push:
    paths:
      - '.github/workflows/**'
  pull_request:
    paths:
      - '.github/workflows/**'
  workflow_dispatch:
  schedule:
    # Run nightly to validate workflows on a schedule (UTC 02:00 daily)
    - cron: '0 2 * * *'

jobs:
  actionlint:
    name: actionlint (GitHub Actions workflows)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install actionlint
        run: |
          set -eux
          # Prefer the official prebuilt binary from releases
          curl -sSL -o /usr/local/bin/actionlint \
            "https://github.com/rhysd/actionlint/releases/latest/download/actionlint_linux_amd64" || true
          if [ ! -x /usr/local/bin/actionlint ]; then
            # Fallback: try to download the tar.gz and extract
            curl -sSL -o /tmp/actionlint.tar.gz \
              "https://github.com/rhysd/actionlint/releases/latest/download/actionlint_linux_amd64.tar.gz"
            tar -xzf /tmp/actionlint.tar.gz -C /tmp
            mv /tmp/actionlint /usr/local/bin/actionlint
          fi
          chmod +x /usr/local/bin/actionlint

      - name: Run actionlint on workflow files
        run: |
          set -eux
          /usr/local/bin/actionlint .github/workflows

  yamllint:
    name: yamllint (YAML syntax & style)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install python and yamllint
        run: |
          python -V
          python -m pip install --upgrade pip
          pip install yamllint
      - name: Run yamllint on .github/workflows
        continue-on-error: true
        run: |
          set -eux
          yamllint .github/workflows || true
